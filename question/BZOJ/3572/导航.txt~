[Hnoi2014]世界树
终于更正完了HNOI2014的所有题目,真是心情愉悦啊
虽然考场上跪了,但好歹考后更正了
这道题凭直觉我觉得是最难的,于是就放在最后更正了,事实也证明这道题花的时间也最长
一开始听见"虚树",就有点虚了,这是什么玩意,没听说过。结果CTSC的时候有个神犇提过,反正不知道
反正最后问了侃农,被他农了半天才明白大概是怎么回事,然后又yy了半天,总算弄出来了
首先把每个节点的dfs序的编号求出来,顺便把每个点为根的子树大小弄出来,然后把倍增表弄出来
然后询问的时候给了一组点,把它们按原树的dfs序排序
接着相邻两个点求lca,如果lca没在数组里,就加到数组里(当然,只是加进去,先不用管它),否则不加到数组里
m个点求完lca后把所有点再按dfs序拍个序
然后开始构虚树,求的时候用个栈来维护
首先把第一个点丢进去,然后从第二个点开始连边
每个点和栈顶元素求lca,如果lca=栈顶元素,就连条边,再把当前点丢到栈顶,否则退栈
连完后每个点都找离它最近的被染掉的点(如果自己也是被染掉的点,最近的就是自己)
以第一个点为根,每个点都从它儿子那找个最近的,最后再扫一遍看看父亲的是不是最近的,如果两个点一样近,就按题目中说的取编号小的
把第一个点的ans设为n,然后再从第一个点开始dfs一遍
每个点如果mark不同于父亲的mark,就要在两个mark之间找分界了
具体找的话就是求mark的lca,因为父亲的mark离lca的距离显然不会比当前点的mark离lca的距离要远(其实lca就是父亲,没必要求),所以从当前点往上爬一定的距离然后从父亲的mark的ans-某个点为根的子树大小,当前点的ans+某个点为根的子树大小就行了,反正我分了链的长度的奇偶讨论
然后把答案输出来就行了
考场上暴力过了样例就没去管了,幸好暴力没跪
还有树链剖分的做法,不过log^2的应该快不到哪里去吧
