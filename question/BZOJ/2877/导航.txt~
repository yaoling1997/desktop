[Noi2012]魔幻棋盘
好久没打数据结构题了,细节把我害惨了
首先对于这种区间+-区间gcd的题就要想到差分,只是二维差分从来没玩过
是二维线段树套差分
看了半天题解,总算明白是什么一回事了
由于这道题有特殊的限制,所以比较好办
以它给出的那个守护者的位置为原点建立直角坐标系(如图)
那些恶心的红色的点就是新转出来的矩阵的点
1.原点的值与原矩阵相同(点(4,4))
2.坐标轴上的点的值=原矩阵中坐标轴上与该点相邻的两点中离原点较远的值-离原点较近的值(例如图中的(2,4) (4,2) (6,4) (4,6)，其值 = 与它相邻的橙色框 - 绿色框中的点的值)
3.象限内的点，例如点(1,1) (1,7) (7,1) (7,7)， 其值=与它相邻的两个橙色框的值之和 - 两个绿色框的值之和
检验一下,发现这样差分确实没问题,而且方便维护(虽然维护起来也挺恶心的)
对于坐标轴上的点分别开两颗一维线段树,平面上的点就开二维的
对于查询,直接查询就好了,由于是差分后的,所以gcd总是有点奇怪,反正最后它要是过坐标轴或原点我也跟他们gcd一下就没问题了,因为它查询的区间一定过原点或某个坐标轴
修改也恶心,要分情况讨论,过了坐标轴就要把相应坐标轴对应的线段树改改,平面也要改,如果改的区间包含原点,原点的值也要改,当然都是单点修改,对于平面只需要考虑修改矩阵的四个顶点影响的小红点就行了,轴线段树也是,修改的时候要注意是+还是-
我差分的时候还在矩阵上面多加一行0,左边多加一列0,不然好像会萎,要是它不保证序列中的数字任何时候都不为0,差分就萎飞了,虽然用过差分但感觉用得不是很熟练,搞半天才搞出来
好久没打模板了,都不熟练了,老是有小地方打错,坑了好多时间,调了半天
