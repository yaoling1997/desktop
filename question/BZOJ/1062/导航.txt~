[NOI2008]糖果雨
浙江OI太丧失了!1道水题,4道难题,1道乱搞题(提答题)
好歹还是过了
这道题目既难想到如何转模型又有超多细节,而且竟然还卡空间,简直不忍直视
搞了一晚上加一上午,正所谓打程序容易调程序难
首先显然要看题解
怎么做?
由于它给了5个参数描述一片云:出现时间t,颜色C,左端点L,右端点R,运动方向D
然后考虑怎么用尽量少的变量来描述
不妨考虑所有云左端点都在左侧
出现时间是可以和位置相互转化的
譬如说云的长度为q= R-L,出现时间是t-L*D,此时云的左端点就在左边界上了
比如说t=2时出现了一片 [1,2]向右(d=1)的云(第一片云)
那么t=1时云左端点就在左边界上了
若另外一片云除了颜色和方向,其它的参数都跟第一片相同(向左移的第二片云),即d=-1
那么t=3时云左端点就在左边界上了
然后描述一片云就只要三个参数:C t q
然后把t看成x轴,q看成y轴,对于一个云就可以用一个点表示出来
设r=len,m= 2r,
现在考虑如何询问
由于运动的周期性,给出的时间都要mod m
为了方便说明,从网上拿了几张图
比如说在时刻t= 0时查询区间[3,5]
对于t= 0的询问
第一片云此时左端点位于左边界右侧距离为1处
第二片云此时左端点位于左边界右侧距离为3处
查询的部分如 图1 所示
当然,其实上边界应该是没有限定的
图的意思是
以左边那个图形为例
t     q
0     >=3
1     >=2
2     >=1
3     >=0
4     >=0
5     >=0
6~14s时云的左端点就超过了R,所以无论多长都不属于查询的范围
右边的图就是关于r对称过去了,因为云是可以往返的
然后为了方便可以补形成 图2
反正下面没点,不会影响答案
然后考虑怎么进一步转,如果给一个平行四边形(暂且看成平行四边形,反正上不封顶),询问有多少个点在那个里面,O(n)枚举每个点的话显然跟暴力差不多了,但是此时有一种神奇的转化,把询问的那个图形转成矩形
对于左边的那个平行四边形,不妨把(x,y)变成(x,y+x)
对于右边的那个平行四边形,不妨把(x,y)变成(x,y+m-x)
因为左边那个平行四边形的底斜率是-1,右边的是+1
查询的区间就变成了两个矩形,统计多少个点在矩形内就可以用二维树状数组了(以前这玩意一直没派上用场,如今终于可以大显身手了,二维线段树显然会MLE)
当然,对于这两个变化方式不同的矩形,我们要开两颗树状数组,其中的点对应相应的变换
为了防止算重,还要注意R=r的情况,此时只要右边那个矩形不算重合的那条线上的点就行了
然后还要考虑时刻t!=0的情况,相当于是把矩形往右移动t个单位
为什么是往右移?这个地方我也纠结了一下子
因为若时刻t=1 有一个点(1,2)
那么此时这个云的左端点到了左边界,所以对于它来说显然是往右移
记住是先平移再坐标变换,坐标变幻时也只是变纵坐标
解决上述问题后,还没完
考虑怎么做比较好处理
把树状数组横坐标扩大一倍,然后在右边插入对应的点,点对应相应的变换
然后查询就可以了
但是,空间会爆掉
然后不得不优化空间
考虑到对于每个树状数组,横坐标真正有用的是3r的范围
然后压一压就行了,比如说左边那个图的树状数组只保留0~3r,右边的则是r~4r
然后还不够,纵坐标也要压,因为第一个树状数组的y不会小于0,少加一点就行了
然后卡着空间过去了
总算结束了艰辛的历程,可以踏上新的征程了
