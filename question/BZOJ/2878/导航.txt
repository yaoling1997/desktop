[Noi2012]迷失游乐园
搞了一下午加一晚上再加超多小时,最后问了wp,终于光明正大地把这玩意搞出来了
就是搞两个数组,一个up一个down维护这个点向上走的期望长度和向下走的期望长度
树上的转移还算好想的,先把down求出来再求up
down[u]= sigma down[v]/(len-1)
叶子节点就是0了
up[u]= w+(down[fa]*(e-1)+up[fa])/e
特殊处理根节点
环上的农了半天,就是枚举每个环上的点对一个每个环上的点的up的贡献
最后每个点是总长*概率的贡献,还有一些细节,比如说两个点相邻,贡献的点度数为2
最后环上点对答案的贡献是(up[i]*2+down[i]*(e-2))/e
最后答案除以n输出即可
